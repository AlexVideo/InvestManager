# Invest Manager

**Версия 0.5.1** — локальный учёт инвест-проектов, маркетинга, договоров, корректировок, ревизий, а также учёт договоров и актов по услугам и работам.

Автор: Ященко Алексей  
ТОО ДП Орталык, рудник Жалпак, 2025 год.

---

## Назначение

Программа предназначена для ведения учёта в двух режимах (два типа баз данных):

1. **Инвест-проекты (товары)** — статьи бюджета с выделенной суммой; операции: маркетинг, договоры, корректировки, ревизии между статьями; привязка к рудникам и участкам; экспорт в Excel, формирование служебных записок.
2. **Услуги и работы** — договоры с контрагентами, суммы договоров, акты выполненных работ (списания); привязка к рудникам и участкам.

Общее для обоих режимов: справочники **рудников** и **участков** (редактирование через «Настройки» → «Рудники и участки…»).

---

## Требования

- **Windows** (для сборки и запуска .exe).
- Для разработки/сборки: **Python 3.10+**, зависимости из `requirements.txt`.

---

## Установка и запуск (разработка)

1. Клонируйте или скопируйте папку проекта.
2. Создайте виртуальное окружение и установите зависимости:
   ```bat
   python -m venv .venv
   .venv\Scripts\activate
   pip install -r requirements.txt
   ```
3. Запуск:
   ```bat
   python app.py
   ```
   При первом запуске программа предложит открыть существующую базу или создать новую; при создании — выбрать тип: «Инвест-проекты» или «Услуги и работы».

---

## Сборка в один исполняемый файл

1. Установите PyInstaller (если ещё не установлен):
   ```bat
   .venv\Scripts\python.exe -m pip install pyinstaller
   ```
2. Для получения **одного самораспаковывающегося .exe** установите [7-Zip](https://www.7-zip.org/), затем запустите:
   ```bat
   build_sfx.bat
   ```
   В папке `dist` появится файл **InvestManager_&lt;версия&gt;_setup.exe** (версия берётся из `version.py`). Его можно переносить на любой ПК (Python и архиваторы там не требуются).

3. Без 7-Zip можно собрать только папку с программой:
   ```bat
   .venv\Scripts\python.exe -m PyInstaller --noconfirm InvestManager.spec
   ```
   Результат: папка `dist\InvestManager` с файлом `InvestManager.exe` и подпапкой `_internal`. Эту папку целиком можно копировать на другой компьютер и запускать `InvestManager.exe`.

Подробнее: файл **КАК_СОБРАТЬ_SFX.txt** в корне проекта.

---

## Структура проекта

| Файл / папка | Описание |
|--------------|----------|
| **app.py** | Точка входа: выбор/создание базы, запуск главного окна. |
| **main_window.py** | Главное окно: интерфейс для режима «Инвест» (таблица проектов, фильтры, сортировка) или «Услуги» (таблица договоров). Меню «База», «О программе». |
| **db.py** | Работа с SQLite: тип БД (invest/services), миграции, проекты, маркетинг, договоры, корректировки, ревизии, рудники/участки, договоры и акты услуг. |
| **utils.py** | Форматирование сумм (деньги, ввод с разрядностью), общие утилиты. |
| **theme.py** | Тёмная тема интерфейса (QSS). |
| **about_dialog.py** | Окно «О программе». |
| **add_project_form.py** | Диалог добавления статьи (инвест): название, бюджет, рудник, участок. |
| **project_card.py** | Карточка проекта: сводка, таблица операций (маркетинг, договоры, корректировки, ревизии), рудник/участок, ревизия, служебная записка. |
| **marketing_form.py** | Ввод/редактирование маркетинговой операции. |
| **contract_form.py** | Ввод/редактирование договора по проекту. |
| **correction_form.py** | Ввод/редактирование корректировки. |
| **revision_form.py** | Ревизия: перенос суммы между статьями, опционально — формирование служебной записки. |
| **doc_generator.py** | Генерация черновика служебной записки (.docx) по ревизии. |
| **export_excel.py** | Экспорт данных инвест-проектов в Excel (сводная + листы по проектам). |
| **bulk_import.py** | Массовый импорт проектов из буфера или Excel. |
| **mines_sections_dialog.py** | Справочники: рудники и участки (добавление, изменение, удаление). |
| **service_contract_form.py** | Диалог добавления/редактирования договора (услуги). |
| **service_contract_card.py** | Карточка договора услуг: данные договора, таблица актов, списано/остаток. |
| **service_act_form.py** | Диалог добавления/редактирования акта выполненных работ. |
| **assets/Invest.ico** | Иконка приложения (окно, панель задач, .exe). |
| **InvestManager.spec** | Конфигурация сборки PyInstaller. |
| **build_sfx.bat** | Сборка приложения и упаковка в один SFX-файл (требуется 7-Zip). |
| **requirements.txt** | Зависимости Python. |

Папки **data**, **build**, **dist**, **.venv** создаются при работе и сборке; в репозитории их можно не хранить (см. `.gitignore`).

---

## Работа с программой (кратко)

- **База данных** (кнопка «База»): открыть другую базу, создать новую, сохранить как, список недавних; пункт «Рудники и участки» — редактирование справочников.
- **Инвест-режим**: добавление статей, импорт, экспорт в Excel; двойной щелчок по строке — карточка проекта (операции, ревизия, служебная записка). В карточке и в форме добавления можно выбрать рудник и участок.
- **Режим услуг**: добавление договоров; двойной щелчок — карточка договора с актами выполненных работ (добавление/редактирование/удаление актов).
- База хранится в одном файле **.db** (SQLite). Рекомендуется хранить файл в удобном месте (например, в папке рядом с программой или в общей папке); один и тот же файл не следует открывать одновременно с нескольких компьютеров по сети.

---

## Подключение к GitHub

1. **Установите Git** с [git-scm.com](https://git-scm.com/), если ещё не установлен.

2. **Создайте репозиторий на GitHub**: зайдите на [github.com](https://github.com) → New repository → имя, например `InvestManager` → Create repository (без README, .gitignore и лицензии — они уже есть в проекте).

3. **В папке проекта** откройте терминал (cmd или PowerShell) и выполните:

   ```bat
   git init
   git add .
   git commit -m "Первоначальный коммит"
   git branch -M main
   git remote add origin https://github.com/AlexVideo/InvestManager.git
   git push -u origin main
   ```

   Репозиторий: [github.com/AlexVideo/InvestManager](https://github.com/AlexVideo/InvestManager). Если репозиторий приватный, при `git push` потребуется авторизация (токен или SSH).

4. **Дальше**: после изменений — `git add .`, `git commit -m "описание"`, `git push`.

В `.gitignore` уже исключены `.venv`, `build`, `dist`, `data`, `Files`, `*.db` и кэш Python — в репозиторий не попадут лишние и пользовательские данные.

---

## Лицензия и использование

Проект предназначен для внутреннего использования. При распространении сборки на других ПК установка Python не требуется.
